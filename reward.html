<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WinQuizBot ‚Äî Get Joker</title>
<style>
  body {
    font-family: Arial, Helvetica, sans-serif;
    background: linear-gradient(135deg, #f0f4ff, #e0ebff);
    text-align: center;
    padding: 24px;
    margin: 0;
  }
  .card {
    background: #fff;
    max-width: 480px;
    margin: 20px auto;
    padding: 24px;
    border-radius: 14px;
    box-shadow: 0 6px 24px rgba(0,0,0,0.08);
  }
  h2 {
    margin-top: 0;
    font-size: 1.4em;
  }
  p {
    color: #444;
    line-height: 1.4;
  }
  button {
    padding: 12px 20px;
    font-size: 16px;
    margin: 8px;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    transition: 0.2s;
  }
  button:hover {
    opacity: 0.9;
  }
  #watchBtn {
    background: #0078d4;
    color: #fff;
  }
  #claimBtn {
    background: #28a745;
    color: #fff;
  }
  #status {
    margin-top: 14px;
    font-weight: 600;
  }
  #status.success { color: #28a745; }
  #status.error { color: #d9534f; }
  #status.info { color: #f0ad4e; }
  #help {
    font-size: 14px;
    color: #666;
    margin-top: 6px;
  }
</style>
</head>
<body>
<div class="card">
  <h2 id="title">üé• Watch ad ‚Äî get a joker</h2>
  <p id="desc">Please watch a short ad. After completion your joker will be credited.</p>

  <div id="controls">
    <button id="watchBtn">‚ñ∂Ô∏è Watch ad</button>
    <button id="claimBtn">‚úÖ Claim reward</button>
  </div>

  <p id="help"></p>
  <div id="status" class="info"></div>
</div>

<script>
const TEXTS = {
  en: {
    title: "üé• Watch an ad ‚Äî claim a daily joker",
    desc: "Watch the ad. After it ends, press \"Claim reward\" to receive your joker.",
    watchBtn: "‚ñ∂Ô∏è View Ad",
    claimBtn: "‚úÖ Claim Reward",
    already: "‚ùó You've already claimed today's joker.",
    success: "‚úÖ Joker credited! Check your bot ‚Äî then press ‚ñ∂Ô∏è Continue to resume the quiz.",
    error: "‚ùå Error while requesting reward. Try again later.",
    waiting: "Please wait ‚Äî loading the ad...",
    noAd: "‚ö†Ô∏è Ad provider not available. Use the Claim button after watching any fallback ad."
  },
  de: {
    title: "üé• Werbung ansehen ‚Äî t√§glichen Joker holen",
    desc: "Sieh dir die Werbung an. Danach auf ‚ÄûBelohnung abholen‚Äú klicken, um deinen Joker zu erhalten.",
    watchBtn: "‚ñ∂Ô∏è Werbung ansehen",
    claimBtn: "‚úÖ Belohnung abholen",
    already: "‚ùó Du hast den heutigen Joker bereits eingel√∂st.",
    success: "‚úÖ Joker gutgeschrieben! Schau im Bot nach ‚Äî dann kannst du das Quiz fortsetzen.",
    error: "‚ùå Fehler beim Einl√∂sen. Versuche es sp√§ter noch einmal.",
    waiting: "Bitte warten ‚Äî Werbung wird geladen...",
    noAd: "‚ö†Ô∏è Werbung nicht verf√ºgbar. Nutze danach den Belohnungs-Button."
  }
};

function params() {
  return new URLSearchParams(window.location.search);
}
const urlParams = params();
const userId = urlParams.get("userid") || urlParams.get("tgid") || urlParams.get("user_id") || "";
const lang = (urlParams.get("lang") || "en").startsWith("de") ? "de" : "en";
const t = TEXTS[lang];

// Elements
const titleEl = document.getElementById("title");
const descEl  = document.getElementById("desc");
const watchBtn = document.getElementById("watchBtn");
const claimBtn = document.getElementById("claimBtn");
const statusEl = document.getElementById("status");
const helpEl   = document.getElementById("help");

// Init UI text
titleEl.textContent = t.title;
descEl.textContent = t.desc;
watchBtn.textContent = t.watchBtn;
claimBtn.textContent = t.claimBtn;
helpEl.textContent = "";

// LocalStorage key (per user)
function lastClaimKey(uid){ return `winquiz_last_claim_${uid}`; }
function claimedToday(uid) {
  if(!uid) return false;
  const key = lastClaimKey(uid);
  const v = localStorage.getItem(key);
  if(!v) return false;
  return v === new Date().toISOString().slice(0,10);
}
function markClaimed(uid) {
  if(!uid) return;
  const key = lastClaimKey(uid);
  localStorage.setItem(key, new Date().toISOString().slice(0,10));
}

function showStatus(msg, type="info"){
  statusEl.textContent = msg;
  statusEl.className = type;
}
function setHelp(msg){ helpEl.textContent = msg; }

async function rewardUser() {
  if(!userId) {
    alert("User id missing");
    return;
  }
  if(claimedToday(userId)) {
    showStatus(t.already, "info");
    return;
  }
  try {
    showStatus(t.waiting, "info");
    const url = `https://thebot-am7g.onrender.com/reward?userid=${encodeURIComponent(userId)}`;
    const res = await fetch(url, { method: "GET" });
    if(res.ok) {
      markClaimed(userId);
      showStatus(t.success, "success");
    } else {
      showStatus(t.error, "error");
    }
  } catch(err) {
    console.error(err);
    showStatus(t.error, "error");
  }
}

async function showRewardedAd() {
  setHelp("");
  if(!userId) {
    setHelp("Missing userid in URL.");
    return;
  }
  if(claimedToday(userId)) {
    showStatus(t.already, "info");
  }
  if(typeof show_9422332 === "function") {
    setHelp(t.waiting);
    try {
      await show_9422332();
      await rewardUser();
    } catch(e) {
      console.warn("Ad failed:", e);
      setHelp(t.noAd);
    }
  } else {
    setHelp(t.noAd);
  }
}

watchBtn.addEventListener("click", async ()=>{
  setHelp(t.waiting);
  if(typeof show_9422332 === "function") {
    try {
      await show_9422332();
      setHelp("");
    } catch(e) {
      console.warn("Ad show failed", e);
      setHelp(t.noAd);
    }
  } else {
    setHelp(t.noAd);
  }
});

claimBtn.addEventListener("click", async ()=>{
  await rewardUser();
});

window.addEventListener("load", ()=>{
  setTimeout(showRewardedAd, 700);
});
</script>

<!-- Monetag script -->
<script src="https://rewardedads.monetag.com/show_9422332.js" async></script>
</body>
</html>
