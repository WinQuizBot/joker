<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WinQuizBot ‚Äî Get Joker & CPX Offers</title>
<style>
  body {
    font-family: Arial, Helvetica, sans-serif;
    background: linear-gradient(135deg, #f0f4ff, #e0ebff);
    text-align: center;
    padding: 24px;
    margin: 0;
  }
  .card {
    background: #fff;
    max-width: 480px;
    margin: 20px auto;
    padding: 24px;
    border-radius: 14px;
    box-shadow: 0 6px 24px rgba(0,0,0,0.08);
  }
  h2 {
    margin-top: 0;
    font-size: 1.4em;
  }
  p {
    color: #444;
    line-height: 1.4;
  }
  button {
    padding: 12px 20px;
    font-size: 16px;
    margin: 8px;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    transition: 0.2s;
    background: #28a745;
    color: white;
  }
  button:hover {
    opacity: 0.9;
  }
  #status {
    margin-top: 14px;
    font-weight: 600;
  }
  #status.success { color: #28a745; }
  #status.error { color: #d9534f; }
  #status.info { color: #f0ad4e; }
  #help {
    font-size: 14px;
    color: #666;
    margin-top: 6px;
  }
  #cpx-container {
    margin-top: 30px;
    max-width: 480px;
    margin-left: auto;
    margin-right: auto;
  }
  iframe {
    width: 100%;
    height: 2000px;
    border: none;
    border-radius: 14px;
    box-shadow: 0 6px 24px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>
<div class="card">
  <h2 id="title">üéÅ T√§glichen Joker abholen</h2>
  <p id="desc">Klicke auf den Button, um deinen t√§glichen Joker zu erhalten.</p>

  <button id="claimBtn">‚úÖ Joker holen</button>

  <p id="status" class="info"></p>
  <p id="help"></p>
</div>

<div id="cpx-container" class="card">
  <h2>üìù Weitere Gewinnlose durch CPX Research</h2>
  <iframe id="cpx-iframe" src=""></iframe>
</div>

<script>
const TEXTS = {
  de: {
    already: "‚ùó Du hast den heutigen Joker bereits eingel√∂st.",
    success: "‚úÖ Joker gutgeschrieben! Schau im Bot nach.",
    error: "‚ùå Fehler beim Einl√∂sen. Versuche es sp√§ter erneut.",
    waiting: "Bitte warten...",
    missingUser: "‚ùó Fehlende Userdaten in der URL."
  }
};

function params() {
  return new URLSearchParams(window.location.search);
}
const urlParams = params();

const userId = urlParams.get("userid") || urlParams.get("tgid") || urlParams.get("user_id") || "";
const username = urlParams.get("username") || urlParams.get("user_name") || "";
const useremail = urlParams.get("email") || "";
const lang = (urlParams.get("lang") || "de").startsWith("de") ? "de" : "en";
const t = TEXTS[lang];

// UI-Elemente
const claimBtn = document.getElementById("claimBtn");
const statusEl = document.getElementById("status");
const helpEl = document.getElementById("help");
const cpxIframe = document.getElementById("cpx-iframe");

// LocalStorage-Funktion, um t√§gliches Claimen zu pr√ºfen
function lastClaimKey(uid){ return `winquiz_last_claim_${uid}`; }
function claimedToday(uid) {
  if(!uid) return false;
  const key = lastClaimKey(uid);
  const v = localStorage.getItem(key);
  if(!v) return false;
  return v === new Date().toISOString().slice(0,10);
}
function markClaimed(uid) {
  if(!uid) return;
  const key = lastClaimKey(uid);
  localStorage.setItem(key, new Date().toISOString().slice(0,10));
}

// Statusanzeige
function showStatus(msg, type="info"){
  statusEl.textContent = msg;
  statusEl.className = type;
}
function setHelp(msg){ helpEl.textContent = msg; }

// Reward anfordern vom Backend
async function rewardUser() {
  if(!userId) {
    showStatus(t.missingUser, "error");
    return;
  }
  if(claimedToday(userId)) {
    showStatus(t.already, "info");
    return;
  }
  try {
    showStatus(t.waiting, "info");
    const url = `https://thebot-am7g.onrender.com/reward?userid=${encodeURIComponent(userId)}`;
    const res = await fetch(url, { method: "GET" });
    if(res.ok) {
      markClaimed(userId);
      showStatus(t.success, "success");
    } else {
      showStatus(t.error, "error");
    }
  } catch(err) {
    console.error(err);
    showStatus(t.error, "error");
  }
}

claimBtn.addEventListener("click", rewardUser);

// CPX iframe URL
